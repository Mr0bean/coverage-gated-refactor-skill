# backend_typescript_nextjs-route-handlers

## 适用场景

- Next.js `app/api/**/route.ts` 路由处理器重构

## 重构思路

1. Handler 轻量化：参数解析、业务逻辑、存储访问拆到 `_route-utils.ts` 或 service 层。
2. 统一错误模型：标准化错误码、错误消息和 HTTP 状态码映射。
3. 强化可测试性：把副作用（文件系统、网络）注入边界，便于 mock。

## 合规思路

1. 鉴权与权限：敏感接口必须有身份校验与最小权限控制。
2. 输入校验：请求参数白名单校验，拒绝隐式类型转换和越权字段。
3. 审计与日志：记录必要审计信息，避免记录凭据、令牌和隐私内容。

## 最佳实践

1. 路由层只做：入参解析、调用 service、出参格式化。
2. 数据契约固定：响应 schema 稳定，向后兼容优先。
3. 失败可观测：错误日志带请求上下文（不含敏感信息）。
4. 测试门禁：接口级回归测试覆盖成功/失败/边界路径。
