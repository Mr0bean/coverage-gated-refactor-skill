# backend_typescript_json-file-storage

## 适用场景

- `lib/db.ts` 与 `data/*.json` 的文件型存储重构

## 重构思路

1. 存储适配层抽象：读写、迁移、初始化分层，避免路由层直接操纵文件细节。
2. 原子写策略：先写临时文件再替换，降低写中断导致的数据损坏风险。
3. schema 演进机制：版本号与迁移函数清晰，兼容历史数据结构。

## 合规思路

1. 数据最小化：仅持久化业务必要字段，敏感字段加密或避免落盘。
2. 数据完整性：写入前后校验结构，异常写入可回滚。
3. 审计可追踪：关键变更记录时间、操作者、影响对象。

## 最佳实践

1. 统一读写入口：所有 JSON 存取经单一 store 模块。
2. 并发安全：避免并发写冲突，必要时加锁或串行队列。
3. 迁移可测试：每个版本迁移配套测试样例。
4. 演进路径明确：文件存储到 DB 的切换预留接口契约。
