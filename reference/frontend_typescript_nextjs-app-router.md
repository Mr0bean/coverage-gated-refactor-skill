# frontend_typescript_nextjs-app-router

## 适用场景

- Next.js App Router 前端页面、组件、状态管理重构

## 重构思路

1. 以路由和业务域拆分：`page` 负责编排，复杂逻辑下沉到 `components/*` 与 `utils/*`。
2. 大文件优先拆：先抽纯函数和类型，再抽可复用组件，最后收敛容器层。
3. 保持 UI 行为一致：先补回归测试再动结构，避免“重构顺便改行为”。
4. 状态边界清晰：本地状态、跨组件状态、持久化状态分层管理。
5. 把副作用集中到少量 hooks 中，降低渲染路径的耦合复杂度。
6. 组件 API 先稳定后拆分，避免 refactor 期间 props 语义漂移。

## 合规思路

1. 输入输出边界合规：用户输入统一校验，避免前端拼接未过滤内容。
2. 隐私合规：前端不落地敏感密钥，不在日志里打印隐私字段。
3. 可访问性合规：关键交互可键盘访问，语义标签和可读提示齐全。
4. 文案合规：错误提示避免泄露内部实现细节或系统路径信息。
5. 埋点合规：事件埋点需遵循最小采集原则，避免采集敏感文本。

## 规范清单

1. 目录规范：按业务域组织目录，不按技术层随意散落。
2. 组件规范：容器组件和展示组件分离，展示组件尽量保持无副作用。
3. 类型规范：公共 props、返回结构、事件 payload 必须显式定义。
4. 命名规范：组件名、hook 名、utils 名遵循统一前缀和语义。
5. 状态规范：禁止在多层组件链路中隐式共享可变对象。
6. 样式规范：禁止跨模块样式污染，局部样式优先。
7. 错误规范：错误边界统一处理，避免在 render 中抛未捕获异常。
8. 注释规范：复杂分支必须补充简洁中英文注释。

## 可参考操作方法

1. 盘点页面：统计超过阈值行数的页面与组件（如 >300 行）。
2. 划分块：按业务块切分为 `view`、`state`、`effects`、`utils`。
3. 先抽纯逻辑：把 formatter、selector、mapper 抽到 `utils` 并补测试。
4. 再抽组件：把重复 UI 块抽成独立组件并建立 props 契约测试。
5. 最后收敛状态：整理状态归属，删除重复 state 与无效 effect。
6. 回归验证：执行页面级测试、关键交互测试、全量回归。
7. 文档同步：更新模块结构、状态流图、关键交互说明。

## 最佳实践

1. 组件分层：容器组件（状态/副作用）与展示组件（纯渲染）分离。
2. TypeScript 严格约束：公共 props/事件 payload 显式类型化。
3. 样式和交互稳定：避免全局样式污染，动画/滚动仅在局部容器处理。
4. 测试策略：组件行为测试 + 页面集成测试并行，覆盖关键状态分支。
5. 把文案、常量、枚举抽离，减少硬编码分散在 JSX。
6. 优先使用组合而不是继承，保持组件替换和复用成本低。
7. 在重构 PR 中附上“行为未变更列表”和“结构变更列表”。
